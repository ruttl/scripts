var Zt=Object.defineProperty;var te=(v,S,E)=>S in v?Zt(v,S,{enumerable:!0,configurable:!0,writable:!0,value:E}):v[S]=E;var Z=(v,S,E)=>te(v,typeof S!="symbol"?S+"":S,E);(function(){"use strict";const v={proxyBaseDomain:"proxy.ruttl.com",logicalPageOrigin:window.location.origin,encodedLivePageOrigin:window.location.origin,proxyBypassDomains:[]},S={proxyBaseDomain:window.RuttlProxyBase||v.proxyBaseDomain,logicalPageOrigin:window.RuttlLogicalPageOrigin||v.logicalPageOrigin,encodedLivePageOrigin:window.RuttlEncodedLivePageOrigin||v.encodedLivePageOrigin,proxyBypassDomains:window.RuttlProxyBypassDomains||v.proxyBypassDomains},E=S.proxyBaseDomain,p=S.logicalPageOrigin,G=S.encodedLivePageOrigin,at=S.proxyBypassDomains,lt=["blob:","data:","https://fonts.googleapis.com/","https://fonts.gstatic.com/","https://images.unsplash.com/","https://firebasestorage.googleapis.com/v0/b/rally-brucira.appspot.com/o","https://firebasestorage.googleapis.com/v0/b/ruttlp.appspot.com/o","https://storage.ruttl.com/"],ut=["javascript:","mailto:","tel:","data:","blob:","about:","chrome-extension:","moz-extension:","webkit-masked-url:"],M={tagName:window.RuttlWebComponentTagName||"ruttl-frame-component",scriptSrc:window.RuttlFrameScriptSrc||"/assets/ruttl-web-component.js"},U="ruttl_p_",O=["href","src","action","poster","content","data-src","data-href","data-url","value","formaction","cite","data","manifest","background","profile","longdesc","usemap","style","srcset","http-equiv","xmlns:xlink"],pt=["href","src","action","poster","content","data-src","data-href","data-url","value","formaction","cite","data","manifest","background","profile","longdesc","usemap","xmlns:xlink"],x={integrity:null,crossorigin:null,"content-security-policy":"_content-security-policy"},q=new WeakMap,V=new WeakMap,A=new WeakMap,I=new WeakMap,$=new WeakMap;let c=window,h=document,w=window.location;function ft(){c=window,h=document,w=window.location,f(c,"RuttlOriginalWindow",{value:c,configurable:!0}),f(c,"RuttlOriginalDocument",{value:h,configurable:!0}),f(c,"RuttlOriginalLocation",{value:w,configurable:!0}),f(c,"RuttlWindowCache",{value:A,configurable:!0}),f(c,"RuttlDocumentCache",{value:I,configurable:!0}),f(c,"RuttlLocationCache",{value:$,configurable:!0})}function y(e){if(e===null||typeof e>"u"){const r=V.get(e);return r||e}return V.get(e)||e}function H(e,r,t){if(q.has(e))return q.get(e);const n=new Proxy(e,r);return q.set(e,n),V.set(n,e),t==="window"?A.set(e,n):t==="document"?I.set(e,n):t==="location"&&$.set(e,n),n}function f(e,r,t){const n=Object.getOwnPropertyDescriptor(e,r);if(n&&!n.configurable)return!1;try{return Object.defineProperty(e,r,{configurable:!0,...t}),!0}catch{return!1}}function X(e,r=!1){const t=new Set;let n=e;for(;n&&n!==Object.prototype;)Object.getOwnPropertyNames(n).forEach(o=>{const i=Object.getOwnPropertyDescriptor(n,o);i&&(r||i.configurable)&&t.add(o)}),Object.getOwnPropertySymbols(n).forEach(o=>t.add(o.toString())),n=Object.getPrototypeOf(n);return Array.from(t)}const N=()=>{},tt=new Promise(N),_=()=>tt;function dt(e){const r=e.protocol.replace(":",""),t=e.hostname.split(".").join("-"),n=e.protocol==="http:"&&e.port==="80"||e.protocol==="https:"&&e.port==="443",o=e.port&&!n?`--${e.port}`:"";return`${r}--${t}${o}`}function gt(e){const r=e.split("--");if(r.length<2){const a=`Malformed encoded host: '${e}'. Expected at least protocol and hostname parts.`;throw new Error(a)}const t=r[0];let n=r.slice(1).join("--"),o="";const i=n.split("--").pop();i&&!isNaN(parseInt(i,10))&&String(parseInt(i,10))===i&&(o=i,n=n.split("--").slice(0,-1).join("--"));const s=n.split("-").join(".");if(!t||!s){const a=`Incomplete decoded host: protocol='${t}', hostname='${s}' from '${e}'`;throw new Error(a)}return`${t}://${s}${o?`:${o}`:""}`}function B(e){try{const r=new URL(e);return r.hostname.endsWith(`.${E}`)&&r.hostname.startsWith("live--")}catch{return!1}}const K=e=>lt.some(r=>e.startsWith(r)),et=e=>at.some(r=>e.includes(r));function d(e,r=p){if(!e)return e;try{const t=new URL(e,r),n=t.href,o=t.protocol.toLowerCase();return K(n)||et(t.hostname)||ut.includes(o)||B(n)?n:`https://live--${dt(t)}.${E}${t.pathname}${t.search}${t.hash}`}catch(t){return console.warn(`[RuttlProxy] Error rewriting URL '${e}' (context: '${r}'):`,t,"Returning original."),e}}function P(e){if(!e)return null;try{const r=new URL(e);if(!r.hostname.endsWith(`.${E}`))return null;const n=r.hostname.split(".")[0];if(!n||!n.startsWith("live--"))return null;const o=n.substring(6);try{const i=gt(o),s=new URL(i);return{originalUrl:`${s.origin}${r.pathname}${r.search}${r.hash}`,originalOrigin:s.origin}}catch(i){return console.warn(`[RuttlProxy] Failed to decode original host from proxied URL '${e}':`,i),null}}catch(r){return console.warn(`[RuttlProxy] Generic error decoding proxied URL '${e}':`,r),null}}const ht=/^(.*?)(?:\s+(\d+w|\d+x|\d+h))?$/;function F(e){return e?e.split(",").map(r=>{const t=r.trim().match(ht);return{url:(t==null?void 0:t[1])||"",descriptor:(t==null?void 0:t[2])||""}}).filter(r=>r.url):[]}function k(e){return!e||e.length===0?"":e.map(r=>`${r.url} ${r.descriptor}`.trim()).join(", ")}const yt="(__RuttlProxy.t(this))",rt=["location","Request","self","top","parent","window","globalThis","open","Worker","XMLHttpRequest","document","history","localStorage","sessionStorage","WebSocket"];function mt(e){if(typeof e!="string"||!e.trim()||e.includes("__RuttlProxy.t(")||e.includes("$RuttlGetVariable"))return e;if(typeof c.acorn>"u"||typeof c.walk>"u"||typeof c.detectGlobals>"u")return console.warn("[RuttlProxy] AST rewriting libraries (acorn, acorn-walk, acorn-globals) not found. Falling back to original script."),e;try{let r=0;const t=[],n=[],o=c.acorn.parse(e,{ecmaVersion:"latest",allowReserved:!0,allowHashBang:!0,onInsertedSemicolon(u){n.push(u),t.push(e.slice(r,u)),r=u}});t.push(e.slice(r)),e=t.join(";");const i=u=>n.reduce((g,m)=>u>m?g+1:g,0),s=c.detectGlobals(o).filter(u=>rt.includes(u.name)).flatMap(u=>u.nodes);c.walk.simple(o,{ThisExpression(u){s.push(u)}}),s.sort((u,g)=>u.start-g.start);let a="",l=0;return s.forEach(u=>{const g=e.slice(l,u.start+i(u.start));switch(a+=g,u.type){case"Identifier":{const m=u.parents&&u.parents[u.parents.length-2];(m==null?void 0:m.type)==="Property"&&m.shorthand?a+=`${u.name}:window.RuttlProxy.o.${u.name}`:a+=`window.RuttlProxy.o.${u.name}`;break}case"ThisExpression":a+=yt;break;default:a+=e.slice(u.start+i(u.start),u.end+i(u.end));break}l=u.end+i(u.end)}),a+=e.slice(l),a}catch(r){return console.error(`[RuttlProxy] Error during AST-based script rewriting: ${String(r)}. Returning original script.`,r),e}}f(c,"wrapScript",{value:mt,configurable:!0});function R(e,r=p){if(!e)return e;let t=e;return t=t.replace(/url\(['"]?([^'")]+?)['"]?\)/gi,(n,o)=>{const i=o.replace(/['"]/g,"");return`url('${d(i,r)}')`}),t=t.replace(/@import\s+['"]([^'"]+)['"]/gi,(n,o)=>`@import '${d(o,r)}'`),t}function Y(e,r,t){const n=r.toLowerCase();let o=t,i=!1,s=!1;if(Object.prototype.hasOwnProperty.call(x,n)){if(x[n]===null)return s=!0,{value:null,changed:!0,shouldRemoveAttribute:!0};n==="http-equiv"&&t.toLowerCase()==="content-security-policy"&&(o=x[n],o!==t&&(i=!0))}if(pt.includes(n))o=d(t,p),o!==t&&(i=!0);else if(n==="style")o=R(t,p),o!==t&&(i=!0);else if(n==="srcset")try{const l=F(t).map(u=>({url:d(u.url,p),descriptor:u.descriptor}));o=k(l),o!==t&&(i=!0)}catch(a){console.warn(`[RuttlProxy] Failed to rewrite srcset for attribute '${r}' on element`,e,`: ${a}`)}else if(n==="http-equiv"&&t.toLowerCase()==="refresh"){const a=e.getAttribute("content");if(a!==null){const l=a.match(/^(\d+;\s*url=)(.+)$/i);if(l!=null&&l[2]){const u=l[2],g=d(u,p);g!==u&&(o=`${l[1]}${g}`,i=!0)}}}return{value:o,changed:i,shouldRemoveAttribute:s}}function wt(e){if(typeof e!="string"||!e.trim())return e;if(typeof DOMParser>"u"){let s=e;return s=s.replace(/(href|src|action)=['"]([^'"]+)['"]/gi,(a,l,u)=>`${l}="${d(u,p)}"`),s=s.replace(/url\(['"]?([^'")]+?)['"]?\)/gi,(a,l)=>`url('${d(l,p)}')`),s}const t=new DOMParser().parseFromString(e,"text/html");if(!t)return console.warn("[RuttlProxy] Failed to parse HTML string with DOMParser. Returning original HTML."),e;t.querySelectorAll(O.map(s=>`[${s}]`).join(", ")+', script, style, meta[http-equiv="refresh"]').forEach(s=>{if(O.forEach(a=>{const l=s.getAttribute(a);if(l===null)return;const u=Y(s,a,l);u.shouldRemoveAttribute?s.removeAttribute(a):u.changed&&s.setAttribute(a,u.value)}),s instanceof SVGElement&&s.hasAttributeNS("http://www.w3.org/1999/xlink","href")){const a=s.getAttributeNS("http://www.w3.org/1999/xlink","href");if(a!==null){const l=d(a,p);l!==a&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",l)}}s.tagName==="SCRIPT"&&s instanceof HTMLScriptElement?s.textContent&&!s.src&&!s.RuttlWrapped&&(s.textContent=c.wrapScript(s.textContent),s.RuttlWrapped=!0):s.tagName==="STYLE"&&s instanceof HTMLStyleElement&&s.textContent&&(s.textContent=R(s.textContent,p))});const o=t.querySelector("base");if(o)o.getAttribute("href")!==G&&o.setAttribute("href",G);else{const s=t.querySelector("head");if(s){const a=t.createElement("base");a.setAttribute("href",G),s.prepend(a)}}return t.querySelectorAll('link[rel*="icon"], link[rel*="apple-touch-icon"], link[rel*="mask-icon"], link[rel*="shortcut"]').forEach(s=>s.remove()),(t.doctype?`<!DOCTYPE ${t.doctype.name}${t.doctype.publicId?` PUBLIC "${t.doctype.publicId}"`:""}${t.doctype.systemId&&!t.doctype.publicId?" SYSTEM":""}${t.doctype.systemId?` "${t.doctype.systemId}"`:""}>`:"")+t.documentElement.outerHTML}f(c,"rewriteHTML",{value:wt,configurable:!0});const nt=O;let b=null;function C(){let e=h.querySelector(`script[src="${M.scriptSrc}"]`);if(e||(e=h.createElement("script"),e.type="module",e.src=M.scriptSrc,e.defer=!0,h.head.appendChild(e)),b=h.querySelector(M.tagName),!b){const r=h.body;r?(b=h.createElement(M.tagName),r.appendChild(b),O.forEach(t=>{if(b&&b.hasAttribute(t)){const n=b.getAttribute(t);if(n){const o=Y(b,t,n);o.shouldRemoveAttribute?b.removeAttribute(t):o.changed&&b.setAttribute(t,o.value)}}})):console.warn("[RuttlProxy] Could not find document.body for web component injection.")}}function z(e){if(!(e instanceof HTMLElement||e instanceof DocumentFragment))return;const r=[];(e instanceof HTMLElement||e instanceof SVGElement)&&r.push(e),r.push(...Array.from(e.querySelectorAll(O.map(t=>`[${t}]`).join(", ")+", script, style")).filter(t=>t instanceof HTMLElement||t instanceof SVGElement)),r.forEach(t=>{if(O.forEach(n=>{const o=t.getAttribute(n);if(o===null)return;const i=Y(t,n,o);i.shouldRemoveAttribute?t.removeAttribute(n):i.changed&&t.setAttribute(n,i.value)}),t instanceof SVGElement&&t.hasAttributeNS("http://www.w3.org/1999/xlink","href")){const n=t.getAttributeNS("http://www.w3.org/1999/xlink","href");if(n!==null){const o=d(n,p);o!==n&&t.setAttributeNS("http://www.w3.org/1999/xlink","href",o)}}t.tagName==="SCRIPT"&&t instanceof HTMLScriptElement?t.textContent&&!t.src&&!t.RuttlWrapped&&(t.textContent=c.wrapScript(t.textContent),t.RuttlWrapped=!0):t.tagName==="STYLE"&&t instanceof HTMLStyleElement&&t.textContent&&(t.textContent=R(t.textContent,p))})}function D(){if(h.documentElement.RuttlObserverSetup)return;h.documentElement.RuttlObserverSetup=!0,new MutationObserver(r=>{r.forEach(t=>{t.type==="attributes"&&t.attributeName&&nt.includes(t.attributeName)&&z(t.target),t.type==="childList"&&t.addedNodes.length>0&&t.addedNodes.forEach(n=>{(n instanceof HTMLElement||n instanceof DocumentFragment)&&z(n)}),t.type==="childList"&&t.removedNodes.length>0&&t.removedNodes.forEach(n=>{(n===b||n instanceof HTMLElement&&n.tagName.toLowerCase()===M.tagName.toLowerCase())&&(console.warn("[RuttlProxy] MutationObserver detected web component was REMOVED! Attempting re-injection."),setTimeout(C,100))})})}).observe(h.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:nt})}function W(){z(h.documentElement)}function Rt(){h.addEventListener("DOMContentLoaded",()=>{C(),W(),D()}),c.addEventListener("load",()=>{C(),W(),D()}),setTimeout(()=>{C(),W(),D()},1e3),setTimeout(()=>{C(),W(),D()},3e3),setTimeout(()=>{C(),W(),D()},5e3)}function St(){var n;const e=Object.getOwnPropertyDescriptor(h,"cookie");if(!e||!e.set||!e.get||(n=e.set)!=null&&n.RuttlPatchedSetter)return;const r=e.set,t=e.get;f(h,"cookie",{get:function(){return t.call(this).split("; ").map(i=>{const s=i.indexOf("=");let a=i,l="";return s>-1&&(a=i.substring(0,s).trim(),l=i.substring(s+1).trim()),a.startsWith(U)?`${a.substring(U.length)}=${l}`:i}).join("; ")},set:function(o){const i=Pt(o);if(!i)return r.call(this,o);const s=new URL(p).hostname;if(i.domain){const l=i.domain.startsWith(".")?i.domain.substring(1):i.domain;(l===s||l.endsWith(`.${s}`))&&(i.domain=`.${E}`)}else i.domain=`.${E}`;if(i.path&&i.path!=="/")try{const l=new URL(i.path,p),u=new URL(d(l.toString(),p));i.path=u.pathname}catch(l){console.warn(`[RuttlProxy] Failed to rewrite cookie path for '${i.path}'`,l),i.path="/"}else i.path="/";i.sameSite="None",i.secure=!0,i.name.startsWith(U)||(i.name=`${U}${i.name}`);const a=bt(i);return r.call(this,a)},configurable:!0,enumerable:e.enumerable}),e.set.RuttlPatchedSetter=!0}function Pt(e){try{const r=e.split(";"),t=r[0];if(t===void 0)return null;const n=t.indexOf("=");let o=t.trim(),i="";if(n>-1&&(o=t.substring(0,n).trim(),i=t.substring(n+1).trim()),!o||i===void 0)return null;const s={name:o,value:i};for(let a=1;a<r.length;a++){const l=r[a].trim(),u=l.indexOf("=");let g,m="";switch(u>-1?(g=l.substring(0,u).trim(),m=l.substring(u+1).trim()):g=l,g.toLowerCase()){case"domain":s.domain=m;break;case"path":s.path=m;break;case"expires":try{s.expires=new Date(m)}catch{}break;case"max-age":s.maxAge=parseInt(m,10);break;case"secure":s.secure=!0;break;case"httponly":s.httpOnly=!0;break;case"samesite":s.sameSite=m;break}}return s}catch(r){return console.warn(`[RuttlProxy] Failed to parse cookie string for doc.cookie: ${e}`,r),null}}function bt(e){let r=`${e.name}=${e.value}`;if(e.expires&&(r+=`; Expires=${e.expires.toUTCString()}`),e.maxAge!==void 0&&!isNaN(e.maxAge)&&(r+=`; Max-Age=${Math.floor(e.maxAge)}`),e.domain&&(r+=`; Domain=${e.domain}`),e.path&&(r+=`; Path=${e.path}`),e.secure&&(r+="; Secure"),e.httpOnly&&(r+="; HttpOnly"),e.sameSite){const t=typeof e.sameSite=="string"?e.sameSite.toLowerCase():"";["strict","lax","none"].includes(t)?r+=`; SameSite=${t.charAt(0).toUpperCase()+t.slice(1)}`:e.sameSite===!0&&(r+="; SameSite=Strict")}return r}function vt(){if(Element.prototype.setAttribute&&!Element.prototype.setAttribute.RuttlPatchedSetter){const e=Element.prototype.setAttribute;Element.prototype.setAttribute=function(r,t){const n=r.toLowerCase();let o=t,i=!1;if(Object.prototype.hasOwnProperty.call(x,n)){if(x[n]===null)return e.call(this,r,"");n==="http-equiv"&&t.toLowerCase()==="content-security-policy"&&(o=x[n],o!==t&&(i=!0))}if(O.includes(n)&&!["style","srcset","http-equiv"].includes(n))o=d(t,p),o!==t&&(i=!0);else if(n==="style")o=R(t,p),o!==t&&(i=!0);else if(n==="srcset")try{const a=F(t).map(l=>({url:d(l.url,p),descriptor:l.descriptor}));o=k(a),o!==t&&(i=!0)}catch(s){console.warn(`[RuttlProxy] Failed to rewrite srcset in setAttribute: ${s}`)}else if(n==="http-equiv"&&t.toLowerCase()==="refresh"){const s=this.getAttribute("content");if(s!==null){const a=s.match(/^(\d+;\s*url=)(.+)$/i);if(a!=null&&a[2]){const l=a[2],u=d(l,p);u!==l&&(o=`${a[1]}${u}`,i=!0)}}}return i?e.call(this,r,o):e.call(this,r,t)},Element.prototype.setAttribute.RuttlPatchedSetter=!0}if(Element.prototype.getAttribute&&!Element.prototype.getAttribute.RuttlPatchedGetter){const e=Element.prototype.getAttribute;Element.prototype.getAttribute=function(r){var n;const t=e.call(this,r);if(t&&typeof t=="string"){const o=r.toLowerCase();if(O.includes(o)){if(B(t))return((n=P(t))==null?void 0:n.originalUrl)||t}else if(o==="srcset")try{const s=F(t).map(a=>{var l;return{url:((l=P(a.url))==null?void 0:l.originalUrl)||a.url,descriptor:a.descriptor}});return k(s)}catch(i){console.warn(`[RuttlProxy] Failed to decode srcset in getAttribute: ${i}`)}else if(o==="http-equiv"&&t.toLowerCase()===x["content-security-policy"])return"content-security-policy"}return t},Element.prototype.getAttribute.RuttlPatchedGetter=!0}if(Element.prototype.setAttributeNS&&!Element.prototype.setAttributeNS.RuttlPatchedSetterNS){const e=Element.prototype.setAttributeNS;Element.prototype.setAttributeNS=function(r,t,n){if(r==="http://www.w3.org/1999/xlink"&&t==="xlink:href"){const o=d(n,p);if(o!==n)return e.call(this,r,t,o)}return e.call(this,r,t,n)},Element.prototype.setAttributeNS.RuttlPatchedSetterNS=!0}if(Element.prototype.getAttributeNS&&!Element.prototype.getAttributeNS.RuttlPatchedGetterNS){const e=Element.prototype.getAttributeNS;Element.prototype.getAttributeNS=function(r,t){var o;const n=e.call(this,r,t);return n&&typeof n=="string"&&r==="http://www.w3.org/1999/xlink"&&t==="href"&&B(n)&&((o=P(n))==null?void 0:o.originalUrl)||n},Element.prototype.getAttributeNS.RuttlPatchedGetterNS=!0}}function Et(){if(["innerHTML","outerHTML"].forEach(e=>{const r=Object.getOwnPropertyDescriptor(Element.prototype,e);if(r&&r.set&&!r.set.RuttlPatched){const t=r.set;f(Element.prototype,e,{set:function(n){const o=c.rewriteHTML(n);return t.call(this,o)},configurable:!0}),r.set.RuttlPatched=!0}}),typeof HTMLIFrameElement<"u"&&HTMLIFrameElement.prototype.srcdoc){const e=Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"srcdoc");if(e&&e.set&&!e.set.RuttlPatched){const r=e.set;f(HTMLIFrameElement.prototype,"srcdoc",{set:function(t){const n=c.rewriteHTML(t);return r.call(this,n)},configurable:!0}),e.set.RuttlPatched=!0}}}function Ot(){if(Node.prototype.appendChild&&!Node.prototype.appendChild.RuttlPatched){const e=Node.prototype.appendChild;Node.prototype.appendChild=function(r){var o;r instanceof Text&&((o=r.parentElement)==null?void 0:o.tagName)==="STYLE"&&(r.textContent=R(r.textContent||"",p));const t=y(this),n=y(r);return e.call(t,n)},Node.prototype.appendChild.RuttlPatched=!0}if(Node.prototype.insertBefore&&!Node.prototype.insertBefore.RuttlPatched){const e=Node.prototype.insertBefore;Node.prototype.insertBefore=function(r,t){var s;r instanceof Text&&((s=r.parentElement)==null?void 0:s.tagName)==="STYLE"&&(r.textContent=R(r.textContent||"",p));const n=y(this),o=y(r),i=y(t);return e.call(n,o,i)},Node.prototype.insertBefore.RuttlPatched=!0}if(Node.prototype.replaceChild&&!Node.prototype.replaceChild.RuttlPatched){const e=Node.prototype.replaceChild;Node.prototype.replaceChild=function(r,t){var s;r instanceof Text&&((s=r.parentElement)==null?void 0:s.tagName)==="STYLE"&&(r.textContent=R(r.textContent||"",p));const n=y(this),o=y(r),i=y(t);return e.call(n,o,i)},Node.prototype.replaceChild.RuttlPatched=!0}}function xt(){if(Element.prototype.insertAdjacentHTML&&!Element.prototype.insertAdjacentHTML.RuttlPatched){const e=Element.prototype.insertAdjacentHTML;Element.prototype.insertAdjacentHTML=function(r,t){const n=c.rewriteHTML(t);return e.call(this,r,n)},Element.prototype.insertAdjacentHTML.RuttlPatched=!0}}function Ct(){if(typeof CSSStyleDeclaration<"u"&&CSSStyleDeclaration.prototype.setProperty&&!CSSStyleDeclaration.prototype.setProperty.RuttlPatched){const e=CSSStyleDeclaration.prototype.setProperty;CSSStyleDeclaration.prototype.setProperty=function(r,t,n){if(t!==null&&typeof t=="string"&&t.includes("url(")){const o=h.createElement("div");o.style.cssText=`${r}: ${t};`;const i=R(o.style.cssText,p).replace(`${r}: `,"").slice(0,-1).trim();return e.call(this,r,i,n??void 0)}return e.call(this,r,t,n??void 0)},CSSStyleDeclaration.prototype.setProperty.RuttlPatched=!0}if(typeof HTMLStyleElement<"u"){const e=Object.getOwnPropertyDescriptor(HTMLStyleElement.prototype,"textContent");if(e&&e.set&&!e.set.RuttlPatched){const r=e.set;f(HTMLStyleElement.prototype,"textContent",{set:function(t){const n=R(t,p);return r.call(this,n)},get:e.get,configurable:!0}),e.set.RuttlPatched=!0}}if(typeof CSSRule<"u"){const e=Object.getOwnPropertyDescriptor(CSSRule.prototype,"cssText");if(e&&e.set&&!e.set.RuttlPatched){const r=e.set;f(CSSRule.prototype,"cssText",{set:function(t){const n=R(t,p);return r.call(this,n)},get:e.get,configurable:!0}),e.set.RuttlPatched=!0}}if(typeof CSSStyleSheet<"u"&&CSSStyleSheet.prototype.insertRule&&!CSSStyleSheet.prototype.insertRule.RuttlPatched){const e=CSSStyleSheet.prototype.insertRule;CSSStyleSheet.prototype.insertRule=function(r,t){const n=R(r,p);return e.call(this,n,t)},CSSStyleSheet.prototype.insertRule.RuttlPatched=!0}if(typeof CSSStyleValue<"u"&&["parse","parseAll"].forEach(e=>{const r=CSSStyleValue[e];if(r&&!r.RuttlPatched){const t=r;f(CSSStyleValue,e,{value:function(n,o){const i=Array.isArray(o)?o.map(s=>R(s,p)):R(o,p);return t.call(this,n,i)},configurable:!0,writable:!0}),r.RuttlPatched=!0}}),typeof CSSKeywordValue<"u"&&!CSSKeywordValue.RuttlPatchedConstructor){const e=CSSKeywordValue;c.CSSKeywordValue=function(r){const t=R(`x:${r}`,p).replace("x:","").trim();return new e(t)},Object.setPrototypeOf(c.CSSKeywordValue,e),Object.setPrototypeOf(c.CSSKeywordValue.prototype,e.prototype),c.CSSKeywordValue.RuttlPatchedConstructor=!0}}function Lt(){if(typeof Text<"u"&&Text.prototype){const e=Text.prototype,r=Object.getOwnPropertyDescriptor(e,"data");if(r&&r.set&&!r.set.RuttlPatchedSetter){const t=r.set,n=r.get;f(e,"data",{set:function(o){let i=o;return this.parentElement&&this.parentElement.tagName==="STYLE"&&(i=R(o,p)),t.call(this,i)},get:function(){return n.call(this)},configurable:!0}),r.set.RuttlPatchedSetter=!0}["appendData","insertData","replaceData"].forEach(t=>{if(e[t]&&!e[t].RuttlPatchedMethod){const n=e[t];f(e,t,{value:function(...o){return this.parentElement&&this.parentElement.tagName==="STYLE"&&typeof o[0]=="string"&&(o[0]=R(o[0],p)),n.apply(this,o)},configurable:!0,writable:!0}),e[t].RuttlPatchedMethod=!0}})}}const L=new WeakMap,ot=new WeakMap;function Tt(e){if(L.has(e))return L.get(e);const r=function(t){let n=t;if(t.type==="message"&&t.data&&t.data.RuttlRewrittenMessage){const o=t.data.RuttlOriginalData,i=t.data.RuttlOriginalOrigin;n=new MessageEvent("message",{bubbles:t.bubbles,cancelable:t.cancelable,data:o,origin:i,lastEventId:t.lastEventId,source:y(t.source),ports:Array.from(t.ports||[])})}e.call(y(this),n)};return L.set(e,r),ot.set(r,e),r}function Mt(){if(EventTarget.prototype.addEventListener&&!EventTarget.prototype.addEventListener.RuttlPatched){const e=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(r,t,n){if(!t)return e.call(this,r,t,n);const o=Tt(t);return e.call(y(this),r,o,n)},EventTarget.prototype.addEventListener.RuttlPatched=!0}if(EventTarget.prototype.removeEventListener&&!EventTarget.prototype.removeEventListener.RuttlPatched){const e=EventTarget.prototype.removeEventListener;EventTarget.prototype.removeEventListener=function(r,t,n){if(!t)return e.call(this,r,t,n);const o=L.get(t)||t;e.call(y(this),r,o,n),L.has(t)&&(L.delete(t),ot.delete(o))},EventTarget.prototype.removeEventListener.RuttlPatched=!0}}function At(){if(typeof MessageEvent<"u"){const e=Object.getOwnPropertyDescriptor(MessageEvent.prototype,"source");if(e&&e.get&&!e.get.RuttlPatched){const r=e.get;f(MessageEvent.prototype,"source",{get:function(){var n;const t=r.call(this);return t instanceof Window&&((n=c.RuttlProxy)==null?void 0:n.w)||t},configurable:!0}),e.get.RuttlPatched=!0}}["UIEvent","MouseEvent"].forEach(e=>{const r=c[e];if(r&&r.prototype){if(!r.RuttlPatchedConstructor){const o=r;c[e]=function(i,s){const a=s?{...s}:{};return a.view&&(a.view=y(a.view)),new o(i,a)},Object.setPrototypeOf(c[e],o),Object.setPrototypeOf(c[e].prototype,o.prototype),c[e].RuttlPatchedConstructor=!0}const t=Object.getOwnPropertyDescriptor(r.prototype,"view");if(t&&t.get&&!t.get.RuttlPatchedGetter){const o=t.get;f(r.prototype,"view",{get:function(){var s;const i=o.call(this);return i instanceof Window&&((s=c.RuttlProxy)==null?void 0:s.w)||i},configurable:!0}),t.get.RuttlPatchedGetter=!0}const n=`init${e}`;if(r.prototype[n]&&!r.prototype[n].RuttlPatched){const o=r.prototype[n];f(r.prototype,n,{value:function(...i){const s=e==="MouseEvent"?4:3;return i[s]&&(i[s]=y(i[s])),o.apply(this,i)},configurable:!0,writable:!0}),r.prototype[n].RuttlPatched=!0}}})}function It(){if(!Function.prototype.RuttlPatchedApply){const e=Function.prototype.apply,r=Function.prototype.call,t=Function.prototype.toString;f(Function.prototype,"RuttlOriginalApply",{value:e,configurable:!0}),f(Function.prototype,"RuttlOriginalCall",{value:r,configurable:!0}),f(Function.prototype,"RuttlOriginalToString",{value:t,configurable:!0}),Function.prototype.apply=function(o,i){const s=this.RuttlOriginalBoundFunction||this;if(s.RuttlOriginalToString&&s.RuttlOriginalToString().match(/\{\s\[native code\]\s\}/)&&!String(s.name).includes("push")&&!String(s.name).includes("concat")&&!String(s.name).includes("Array"))try{if(o=y(o),i)for(let a=0;a<i.length;a++)i[a]=y(i[a])}catch(a){console.warn("[RuttlProxy] Error unwrapping arguments for native apply:",a)}return Function.prototype.RuttlOriginalApply.call(this,o,i)},f(Function.prototype,"RuttlPatchedApply",{value:!0,configurable:!0}),Function.prototype.call=function(o,...i){const s=this.RuttlOriginalBoundFunction||this;if(s.RuttlOriginalToString&&s.RuttlOriginalToString().match(/\{\s\[native code\]\s\}/)&&!String(s.name).includes("push")&&!String(s.name).includes("concat")&&!String(s.name).includes("Array"))try{if(o=y(o),i)for(let a=0;a<i.length;a++)i[a]=y(i[a])}catch(a){console.warn("[RuttlProxy] Error unwrapping arguments for native call:",a)}return Function.prototype.RuttlOriginalApply.call(this,o,i)},f(Function.prototype,"RuttlPatchedCall",{value:!0,configurable:!0});const n=Function.prototype.bind;Function.prototype.RuttlPatchedBind||(Function.prototype.bind=function(o,...i){const s=this.RuttlOriginalBoundFunction||this;if(s.RuttlOriginalToString&&s.RuttlOriginalToString().match(/\{\s\[native code\]\s\}/))try{if(o=y(o),i)for(let l=0;l<i.length;l++)i[l]=y(i[l])}catch(l){console.warn("[RuttlProxy] Error unwrapping arguments for native bind:",l)}const a=n.call(this,o,...i);return f(a,"RuttlOriginalBoundFunction",{value:s,configurable:!0}),a},f(Function.prototype,"RuttlPatchedBind",{value:!0,configurable:!0}))}}function J(e){if($.has(e))return $.get(e);const r=X(e,!0),n=H(e,{get(o,i,s){if(typeof i=="string"){const l=P(o.href);if(l){const u=new URL(l.originalUrl);switch(i){case"origin":return u.origin;case"href":return u.href;case"protocol":return u.protocol;case"host":return u.host;case"hostname":return u.hostname;case"port":return u.port;case"pathname":return u.pathname;case"search":return u.search;case"hash":return u.hash}}}if(i==="toString"||i==="valueOf")return function(){var l;return((l=P(o.href))==null?void 0:l.originalUrl)||o.href};const a=Reflect.get(o,i,s);return typeof a=="function"&&r.includes(String(i))&&i!=="constructor"?a.bind(o):a},set(o,i,s,a){var l;if(typeof i=="string"&&["href","protocol","host","hostname","port","pathname","search","hash"].includes(i)){const u=((l=P(o.href))==null?void 0:l.originalUrl)||o.href,g=new URL(u);g[i]=s;const m=d(g.toString(),p);return Reflect.set(w,"href",m)}return Reflect.set(o,i,s,a)}},"location");return $.set(e,n),n}function $t(e){if(I.has(e))return I.get(e);const r=X(e,!0),n=H(e,{get(o,i,s){var l,u;if(i==="location")return J(o.location);if(i==="referrer"){const g=Reflect.get(o,i,s);return((l=P(g))==null?void 0:l.originalUrl)||g}if(i==="URL"||i==="documentURI"||i==="baseURI"){const g=Reflect.get(o,i,s);return((u=P(g))==null?void 0:u.originalUrl)||g}const a=Reflect.get(o,i,s);return typeof a=="function"&&r.includes(String(i))&&i!=="constructor"?a.bind(o):a},set(o,i,s,a){return Reflect.set(o,i,s,a)}},"document");return I.set(e,n),n}function T(e){if(!e)return null;if(A.has(e))return A.get(e);const r=X(e,!0),n=H(e,{get(o,i,s){var l,u;if(window.RuttlProxy&&window.RuttlProxy.o&&Object.prototype.hasOwnProperty.call(window.RuttlProxy.o,i))return window.RuttlProxy.o[i];if(i==="location")return J(o.location);if(i==="document")return $t(o.document);if(i==="top")return T(o.top);if(i==="parent")return T(o.parent);if(i==="self"||i==="window")return T(o);if(i==="frames")return new Proxy(o.frames,{get(g,m){if(typeof m=="string"&&!isNaN(parseInt(m,10))){const j=g[parseInt(m,10)];return T(j)}return Reflect.get(g,m)}});if(i==="opener")return T(o.opener);if(i==="postMessage"&&!((u=(l=window.RuttlProxy)==null?void 0:l.o)!=null&&u.postMessage))return(function(g,m="*",j){const Q=it(g,m);return o.postMessage(Q.finalMessage,Q.rewrittenTargetOrigin,j)}).bind(o);const a=Reflect.get(o,i,s);return typeof a=="function"&&r.includes(String(i))&&i!=="constructor"?a.bind(o):a},set(o,i,s,a){return window.RuttlProxy&&window.RuttlProxy.o&&Object.prototype.hasOwnProperty.call(window.RuttlProxy.o,i)?i==="location"&&s===window.RuttlProxy.o.location?Reflect.set(o,i,s,a):(console.warn(`[RuttlProxy] Attempted to set spoofed global property '${String(i)}' on proxied window. Blocked.`),!0):Reflect.set(o,i,s,a)}},"window");return A.set(e,n),n}function it(e,r="*"){const t=r==="*"?"*":d(r.toString(),p);let n=e;return typeof e=="object"&&e!==null?n={RuttlRewrittenMessage:!0,RuttlOriginalData:e,RuttlOriginalOrigin:p}:typeof e=="string"&&(n=d(e,p)),{rewrittenTargetOrigin:t,finalMessage:n}}function Ht(){if(c.RuttlProxy)return;const e={};e.t=t=>y(t),e.w=H(c,{get:(t,n,o)=>e.o&&Object.prototype.hasOwnProperty.call(e.o,n)?e.o[n]:Reflect.get(t,n,o),set:(t,n,o,i)=>e.o&&Object.prototype.hasOwnProperty.call(e.o,n)?(console.warn(`[RuttlProxy] Attempted to set spoofed global property '${String(n)}'. Blocked.`),!1):Reflect.set(t,n,o,i)},"window"),e.o={location:(()=>{const t=new URL(p);return{protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,origin:t.origin,pathname:t.pathname,search:t.search,hash:t.hash,href:t.href,assign:n=>{w.assign(d(n.toString(),p))},reload:n=>{w.reload.call(w,n)},replace:n=>{w.replace(d(n.toString(),p))},toString(){return this.href},valueOf(){return this.href}}})(),Request:class extends Request{constructor(n,o){let i=n;typeof n=="string"?K(n)||(i=d(n,p)):n instanceof URL&&(i=new URL(d(n.toString(),p))),super(i,o)}},self:e.w,top:e.w,parent:e.w,window:e.w,globalThis:e.w,open:function(t,n,o){const i=t?d(t.toString(),p):void 0,s=c.open(i,n,o);return T(s)},Worker:class extends Worker{constructor(n,o){const i=d(n.toString(),p);super(i,o)}},postMessage:(t,n="*",o)=>{const i=it(t,n);c.parent.postMessage(i.finalMessage,i.rewrittenTargetOrigin,o)},document:h,history:c.history,localStorage:c.localStorage,sessionStorage:c.sessionStorage,WebSocket},f(c,"RuttlProxy",{value:e,configurable:!0});const r=rt;r&&Array.isArray(r)&&r.forEach(t=>{Object.prototype.hasOwnProperty.call(e.o,t)&&f(c,t,{get:()=>e.o[t],set:n=>{Reflect.set(c,t,n)},configurable:!0,enumerable:!0})})}function Ft(){if(!w.RuttlPatched){const e=J(w);f(c,"location",{get:()=>e,set:o=>{typeof o=="string"?w.assign(d(o,p)):w.assign(d(o.toString(),p))},enumerable:!0})?w.RuttlPatched=!0:console.warn("[RuttlProxy] Failed to patch window.location directly. Some operations might bypass proxy.");const r=w.assign;r.RuttlPatchedMethod||(w.assign=function(o){const i=d(o.toString(),p);r.call(this,i)},w.assign.RuttlPatchedMethod=!0);const t=w.replace;t.RuttlPatchedMethod||(w.replace=function(o){const i=d(o.toString(),p);t.call(this,i)},w.replace.RuttlPatchedMethod=!0);const n=w.reload;w.reload.RuttlPatchedMethod||(w.reload=function(o){n.call(this,o)},w.reload.RuttlPatchedMethod=!0)}}function kt(){typeof c.history<"u"&&["pushState","replaceState"].forEach(e=>{const r=c.history[e];r&&!r.RuttlPatched&&(f(c.history,e,{value:function(t,n,o){const i=o?d(o.toString(),p):void 0;return r.call(this,t,n,i)},configurable:!0,writable:!0}),c.history[e].RuttlPatched=!0)})}function Dt(){if(typeof h.write<"u"&&!h.write.RuttlPatched){const e=h.write;h.write=function(...r){const t=r.map(n=>typeof n=="string"?c.rewriteHTML(n):n);return e.apply(this,t)},h.write.RuttlPatched=!0}if(typeof h.writeln<"u"&&!h.writeln.RuttlPatched){const e=h.writeln;h.writeln=function(...r){const t=r.map(n=>typeof n=="string"?c.rewriteHTML(n):n);return e.apply(this,t)},h.writeln.RuttlPatched=!0}}function Wt(){if(typeof Blob<"u"&&!Blob.RuttlPatchedConstructor){const e=Blob;c.Blob=function(r,t){let n=r;return t&&t.type&&t.type.includes("text/css")&&(n=r==null?void 0:r.map(o=>typeof o=="string"?R(o,p):o)),new e(n,t)},Object.setPrototypeOf(c.Blob,e),Object.setPrototypeOf(c.Blob.prototype,e.prototype),c.Blob.RuttlPatchedConstructor=!0}}function Ut(){if(typeof FontFace<"u"&&!FontFace.RuttlPatchedConstructor){const e=FontFace;c.FontFace=function(r,t,n){let o=t;if(typeof t=="string"){const i=t.match(/url\(['"]?([^'")]+?)['"]?\)/i);if(i&&i[1]!==void 0){const s=i[1],a=d(s,p);o=t.replace(s,a)}}return new e(r,o,n)},Object.setPrototypeOf(c.FontFace,e),Object.setPrototypeOf(c.FontFace.prototype,e.prototype),c.FontFace.RuttlPatchedConstructor=!0}}function Nt(){if(Element.prototype.animate&&!Element.prototype.animate.RuttlPatched){const e=Element.prototype.animate;f(Element.prototype,"animate",{value:function(r,t){let n=r;if(n&&typeof n=="object")if(Array.isArray(n))n=n.map(o=>{const i={...o};for(const s in i)typeof i[s]=="string"&&i[s].includes("url(")&&(i[s]=R(`${s}:${i[s]}`,p).replace(`${s}:`,"").trim());return i});else{const o={...n};for(const i in o)Array.isArray(o[i])?o[i]=o[i].map(s=>typeof s=="string"&&s.includes("url(")?R(`x:${s}`,p).replace("x:","").trim():s):typeof o[i]=="string"&&o[i].includes("url(")&&(o[i]=R(`x:${o[i]}`,p).replace("x:","").trim());n=o}return e.call(this,n,t)},configurable:!0,writable:!0}),Element.prototype.animate.RuttlPatched=!0}}function _t(){if(typeof Image<"u"&&!Image.RuttlPatchedConstructor){const e=Image;c.Image=function(r,t){const n=new e(r,t);return f(n,"src",{get:function(){var o;return((o=P(n.src))==null?void 0:o.originalUrl)||n.src},set:function(o){n.src=d(o,p)},configurable:!0}),f(n,"srcset",{get:function(){try{const i=F(n.srcset).map(s=>{var a;return{url:((a=P(s.url))==null?void 0:a.originalUrl)||s.url,descriptor:s.descriptor}});return k(i)}catch(o){return console.warn(`[RuttlProxy] Failed to decode Image.srcset on get: ${o}`),n.srcset}},set:function(o){try{const s=F(o).map(a=>({url:d(a.url,p),descriptor:a.descriptor}));n.srcset=k(s)}catch(i){console.warn(`[RuttlProxy] Failed to rewrite Image.srcset on set: ${i}`),n.srcset=o}},configurable:!0}),n},Object.setPrototypeOf(c.Image,e),Object.setPrototypeOf(c.Image.prototype,e.prototype),c.Image.RuttlPatchedConstructor=!0}}function Bt(){if(typeof c.setTimeout<"u"&&!c.setTimeout.RuttlPatchedStringArg){const e=c.setTimeout;c.setTimeout=function(r,t,...n){if(typeof r=="string"){const o=c.wrapScript(r);return e.call(this,o,t,...n)}return e.apply(this,[r,t,...n])},c.setTimeout.RuttlPatchedStringArg=!0}if(typeof c.setInterval<"u"&&!c.setInterval.RuttlPatchedStringArg){const e=c.setInterval;c.setInterval=function(r,t,...n){if(typeof r=="string"){const o=c.wrapScript(r);return e.call(this,o,t,...n)}return e.apply(this,[r,t,...n])},c.setInterval.RuttlPatchedStringArg=!0}}function jt(){if(typeof HTMLCanvasElement<"u"&&HTMLCanvasElement.prototype.getContext&&!HTMLCanvasElement.prototype.getContext.RuttlPatched){const e=HTMLCanvasElement.prototype.getContext;f(HTMLCanvasElement.prototype,"getContext",{value:function(r,t){let n=t;return["webgl","experimental-webgl","webgl2"].includes(r)&&(n={...t,preserveDrawingBuffer:!0}),e.call(this,r,n)},configurable:!0,writable:!0}),HTMLCanvasElement.prototype.getContext.RuttlPatched=!0}}function Gt(){if(typeof MutationObserver<"u"&&!MutationObserver.prototype.observe.RuttlPatched){const e=MutationObserver.prototype.observe;f(MutationObserver.prototype,"observe",{value:function(r,t){const n=y(r);return e.call(this,n,t)},configurable:!0,writable:!0}),MutationObserver.prototype.observe.RuttlPatched=!0}}function qt(){if(typeof IntersectionObserver<"u"&&!IntersectionObserver.RuttlPatchedConstructor){const e=IntersectionObserver;c.IntersectionObserver=function(r,t){const n=t?{...t}:{};n.root&&(n.root=y(n.root));const o=(i,s)=>{const a=i.map(l=>{let u=l.rootBounds;const g=c.self!==c.top;return l.rootBounds===null&&g&&(u={bottom:c.innerHeight,top:0,height:c.innerHeight,width:c.innerWidth,left:0,right:c.innerWidth,x:0,y:0,toJSON:()=>({x:0,y:0,width:c.innerWidth,height:c.innerHeight,top:0,right:c.innerWidth,bottom:c.innerHeight,left:0})}),{...l,target:l.target,rootBounds:u}});return r(a,s)};return new e(o,n)},Object.setPrototypeOf(c.IntersectionObserver,e),Object.setPrototypeOf(c.IntersectionObserver.prototype,e.prototype),c.IntersectionObserver.RuttlPatchedConstructor=!0}}function Vt(){var e,r;if(typeof c.fetch<"u"&&!c.fetch.RuttlPatched){const t=c.fetch;(r=(e=c.RuttlProxy)==null?void 0:e.o)!=null&&r.Request?c.fetch=function(n,o){let i=n;return(typeof n=="string"||n instanceof URL||n instanceof Request)&&(i=new c.RuttlProxy.o.Request(n,o)),t.call(this,i,o)}:(console.warn("[RuttlProxy] RuttlProxy.o.Request not available during overrideFetch. Ensure setupGlobalRuttlObject runs first."),c.fetch=function(n,o){let i=n;return(typeof n=="string"||n instanceof URL)&&(K(n.toString())||(i=d(n.toString(),p))),t.call(this,i,o)}),c.fetch.RuttlPatched=!0}}function Xt(){if(typeof XMLHttpRequest<"u"&&!XMLHttpRequest.prototype.open.RuttlPatched){const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,n,...o){const i=d(n.toString(),p);e.apply(this,[t,i,...o])},XMLHttpRequest.prototype.open.RuttlPatched=!0;const r=Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"responseURL");if(r&&r.get&&!r.get.RuttlPatched){const t=r.get;f(XMLHttpRequest.prototype,"responseURL",{get:function(){const n=t.call(this),o=P(n);return o?o.originalUrl:n},configurable:!0}),r.get.RuttlPatched=!0}}}function Kt(){if(typeof c.navigator<"u"&&typeof c.navigator.sendBeacon<"u"&&!c.navigator.sendBeacon.RuttlPatched){const e=c.navigator.sendBeacon;c.navigator.sendBeacon=function(r,t){const n=d(r.toString(),p);return e.call(this,n,t)},c.navigator.sendBeacon.RuttlPatched=!0}}function Yt(){if(typeof WebSocket<"u"&&!WebSocket.RuttlPatchedConstructor){const e=WebSocket;c.WebSocket=function(r,t){const n=d(r.toString(),p);return new e(n,t)},Object.setPrototypeOf(c.WebSocket,e),Object.setPrototypeOf(c.WebSocket.prototype,e.prototype),c.WebSocket.RuttlPatchedConstructor=!0}}function zt(){typeof HTMLFormElement<"u"&&HTMLFormElement.prototype.submit&&!HTMLFormElement.prototype.submit.RuttlPatched&&(HTMLFormElement.prototype.submit=N,HTMLFormElement.prototype.submit.RuttlPatched=!0)}class st{constructor(r){Z(this,"_storage");Z(this,"_prefix");this._storage=r,this._prefix=`${new URL(p).hostname}::`}getItem(r){return this._storage.getItem(this._prefix+r)}setItem(r,t){this._storage.setItem(this._prefix+r,t)}removeItem(r){this._storage.removeItem(this._prefix+r)}clear(){for(let r=this._storage.length-1;r>=0;r--){const t=this._storage.key(r);t&&t.startsWith(this._prefix)&&this._storage.removeItem(t)}}key(r){let t=0;for(let n=0;n<this._storage.length;n++){const o=this._storage.key(n);if(o&&o.startsWith(this._prefix)){if(t===r)return o.substring(this._prefix.length);t++}}return null}get length(){let r=0;for(let t=0;t<this._storage.length;t++){const n=this._storage.key(t);n&&n.startsWith(this._prefix)&&r++}return r}}function ct(e){return H(e,{get(r,t,n){if(typeof t=="string"&&["getItem","setItem","removeItem","clear","key","length"].includes(t))return Reflect.get(r,t,n);const o=r.getItem(String(t));return o!==null?o:Reflect.get(r,t,n)},set(r,t,n,o){return typeof t=="string"&&["getItem","setItem","removeItem","clear","key","length"].includes(t)?!1:(r.setItem(String(t),String(n)),!0)},has(r,t){return typeof t=="string"&&["getItem","setItem","removeItem","clear","key","length"].includes(t)||r.getItem(String(t))!==null},ownKeys(r){const t=[];for(let n=0;n<r.length;n++){const o=r.key(n);o!==null&&t.push(o)}return t},getOwnPropertyDescriptor(r,t){if(typeof t=="string"&&["getItem","setItem","removeItem","clear","key","length"].includes(t))return Reflect.getOwnPropertyDescriptor(r,t);if(r.getItem(String(t))!==null)return{value:r.getItem(String(t)),writable:!0,enumerable:!0,configurable:!0}}})}function Jt(){try{if(typeof c.localStorage<"u"&&!c.localStorage.RuttlPatched){const e=new st(c.localStorage),r=ct(e);f(c,"localStorage",{get:()=>r,configurable:!0}),c.localStorage.RuttlPatched=!0}if(typeof c.sessionStorage<"u"&&!c.sessionStorage.RuttlPatched){const e=new st(c.sessionStorage),r=ct(e);f(c,"sessionStorage",{get:()=>r,configurable:!0}),c.sessionStorage.RuttlPatched=!0}}catch(e){console.warn("[RuttlProxy] Failed to patch localStorage/sessionStorage:",e)}}function Qt(){c.navigator&&c.navigator.serviceWorker&&!c.navigator.serviceWorker.RuttlPatched&&(f(c.navigator,"serviceWorker",{value:{ready:tt,register:_,getRegistration:_,getRegistrations:_,addEventListener:N,controller:{postMessage:N}},configurable:!0}),c.navigator.serviceWorker.RuttlPatched=!0),typeof ServiceWorkerContainer<"u"&&ServiceWorkerContainer.prototype.register&&!ServiceWorkerContainer.prototype.register.RuttlPatched&&(f(ServiceWorkerContainer.prototype,"register",{value:_,configurable:!0,writable:!0}),ServiceWorkerContainer.prototype.register.RuttlPatched=!0)}(function(){if(ft(),c.RuttlProxyIsLoaded){console.warn("[RuttlProxy] Already initialized. Skipping re-initialization.");return}c.RuttlProxyIsLoaded=!0;try{const r=new URL(c.location.href);!B(r.toString())&&et(r.hostname)}catch(r){console.error("[RuttlProxy] Error during self-protection check:",r)}console.log("[RuttlProxy] Initializing Ruttl client-side interceptor (Refactored)..."),Ht(),It(),Ft(),Vt(),Xt(),Kt(),Yt(),zt(),kt(),Dt(),St(),Jt(),Qt(),vt(),Et(),Ot(),xt(),Ct(),Lt(),Wt(),Ut(),Nt(),_t(),jt(),Bt(),Mt(),At(),Gt(),qt(),Rt(),console.log("[RuttlProxy] Ruttl client-side interceptor initialized successfully.")})()})();
